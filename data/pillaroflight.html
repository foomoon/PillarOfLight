<html>

  <head>
    <title>Pillar of Light</title>

    <!-- <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="144x144"  href="/favicon-144x144.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json"> -->

    <link href="pillaroflight.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.jsdelivr.net/gh/artf/grapick@0.1.7/dist/grapick.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    

    <!-- <script src="https://cdn.jsdelivr.net/gh/jaames/iro.js@master/dist/iro.min.js" type="text/javascript"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/cash-dom@8.0.0/dist/cash.min.js" type="text/javascript"></script>
    <script type="text/javascript">jQuery = $;</script> <!-- /* Patch for jquery dependencies (ie rangeslider) */ -->


    <!-- LED Strip and effects -->
    <script src="https://cdn.jsdelivr.net/gh/foomoon/LEDStrip/ledstrip.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/foomoon/LEDStrip/ws2812.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/foomoon/LEDStrip/fire.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/foomoon/LEDStrip/larson.min.js" type="text/javascript"></script>

    <script src="https://cdn.jsdelivr.net/npm/rangeslider.js@2.3.3/dist/rangeslider.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/artf/grapick@0.1.7/dist/grapick.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/bgrins/TinyColor@1.4.1/dist/tinycolor-min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ajv/6.12.4/ajv.min.js" type="text/javascript"></script>

    <script src="WebSocket.js" type="text/javascript"></script>
    <script src="pillaroflight.js" type="text/javascript"></script>

    <script type="text/javascript">

      /*  LED Strip and effects */
      var repo = [{
        name: "https://cdn.jsdelivr.net/gh/foomoon/LEDStrip",
        version: "", //"@latest",
        files: ["ledstrip", "ws2812", "fire", "larson"], // "chasers", "bouncingballs", "lightning", "twinklesparkle", "color_wave", "color_cycle", "water_torture", "eyeblink", "arduino_funcs"],
        ext: ".min.js"
      }]

      //addScripts(repo)


      function addScripts(repo) {
        for (let i = 0; i < repo.length; i++) {
          for (let j = 0; j < repo[i].files.length; j++) {
            let url = repo[i].name + repo[i].version + "/" + repo[i].files[j] + repo[i].ext
            var script = document.createElement('script');
            script.setAttribute('src', url);
            script.setAttribute('type', 'text/javascript');
            script.setAttribute("async", "false");
            document.head.appendChild(script);
          }
        }
      }

      // Stubbed out for debug only
      if (typeof(connection) == "undefined") {
        var connection = {
          send: function(str) {
            // Print to console rather than sending via websocket
            console.log(JSON.parse(str))
          }
        }
      }


      /// Initiate PillarOfLight App
      document.addEventListener("DOMContentLoaded", () => {
      
        let ajv = new Ajv({
          allErrors: true
        });

        const savedEffectsURL = "https://cdn.jsdelivr.net/gh/foomoon/PillarOfLight@latest/data/saved_effects.json"
        const jsonSchemaURL = "https://cdn.jsdelivr.net/gh/foomoon/PillarOfLight@master/data/schema.json"

        fetchValidJSON(ajv, savedEffectsURL, jsonSchemaURL)
          .then(json => {
            return json
          })
          .catch(error => {
            defaultData.error = error
            return defaultData
          })
          .then(result => {
            if (result.error) {
              console.warn(result.error + " - Using Default Data")
            }
            let pillar = new PillarOfLight(result)
            pillar.setValidator(ajv)
            pillar.show()
            styleFileInput()
          })
      })

    </script>

    

    


  </head>

  <body>




    <div class="app">
      <header>
        <h1>Pillar of Light</h1>
      </header>
      <nav>
        <div class="simulation"></div>
      </nav>
      <main>
        <div class="effects">
          <div class="effectSelector"></div>
          <div class="controls"></div>
        </div>
      </main>
      <footer>
        <div class="center">
          <a class="button" href="#">Live</a>
          <a class="button" href="#" onclick="saveData()">Save</a>
        </div>
      </footer>
    </div> <!-- .app -->


      <div class="app">
      <header>
        <h1>File Uploader</h1>
      </header>
      <main>
        <div style="text-align:center">
          <p>Use this page to upload new files to the ESP8266.<br />You can use compressed (deflated) files (files with a .gz extension) to save space and bandwidth.</p>
        </div>
      </main>
      <footer>
        <form class="center" method="post" enctype="multipart/form-data">
          <label class="button" for="file">
            <i class="material-icons md-18">backup</i>
            <span>Choose File</span>
          </label>
          <input id="file" class="inputfile" type="file" name="Choose file" accept=".gz,.html,.ico,.js,.css,.json,.png" data-multiple-caption="{count} Files" multiple>
          <input class="button" type="submit" value="Upload" name="submit">
        </form>
      </footer>
    </div>

  </body>


</html>

